"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[741],{74226:function(de,w,n){n.r(w),n.d(w,{default:function(){return ie}});var Q=n(48305),m=n.n(Q),G=n(90228),F=n.n(G),Y=n(87999),J=n.n(Y),$=n(15558),T=n.n($),k=n(13978),U=n(37023),b=n(63346),K=n(97395),V=n(54814),X=n(28974),c=n(56651),g=n(45659),A=n(11974),q=n(77536),f=n(10105),_=n(43316),H=n(27685),l=n(75271),e=n(52676),ee=g.Z.Header,ne=g.Z.Content,L=A.Z.Text,te=function(x){var S=x.isMobile,h=(0,c.useDispatch)(),C=(0,l.useState)(""),a=m()(C,2),y=a[0],d=a[1],B=(0,c.useSelector)(function(r){return r.conversation}),o=B.userIsFocus,j=(0,c.useSelector)(function(r){return r.auth}),Z=j.authData,z=(0,l.useState)([]),I=m()(z,2),E=I[0],i=I[1],R=function(){if(y===""){q.ZP.error("Please fill in text input");return}h({type:"conversation/sendMessage",payload:y}),d("")};(0,l.useEffect)(function(){if(o&&o.conversation_id!==""){var r=k.O.channel(o.conversation_id).on("postgres_changes",{event:"*",schema:"public",table:"messages"},function(t){t.new&&(console.log("first",o.conversation_id),o.conversation_id!==""&&o.conversation_id===t.new.conversation_id&&i(function(s){return[].concat(T()(s),[typeof t.new=="string"?JSON.parse(t.new):t.new])}))});r.subscribe(function(t){t==="SUBSCRIBED"&&console.log("Successfully subscribed to the channel")})}},[o.conversation_id]);var P=function(){var r=J()(F()().mark(function t(s){var v;return F()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,(0,U.rb)(s);case 2:v=u.sent,i(v);case 4:case"end":return u.stop()}},t)}));return function(s){return r.apply(this,arguments)}}(),M=function(t){(0,U.x5)(o.conversation_id,Z.user.id,t)};return(0,l.useEffect)(function(){console.log(o,(0,b.Qr)(o)),!(0,b.Qr)(o)&&o.conversation_id!==""?P(o.conversation_id):i([])},[o]),(0,e.jsxs)("div",{style:{overflowY:"hidden",height:"100vh"},children:[(0,e.jsxs)(ee,{style:{background:"#f5f5f5",padding:"16px 24px",borderBottom:"1px solid #e8e8e8",fontSize:20,fontWeight:700,display:"flex",alignItems:"center"},children:[(0,e.jsx)(f.ZP,{style:{background:"#f5f5f5",border:0,boxShadow:"0 0 0 0 0 0"},onClick:function(){h({type:"conversation/clearUserIsFocus"})},children:(0,e.jsx)(K.Z,{size:50})}),(0,e.jsx)("img",{src:o.avatar,style:{height:50,width:50,borderRadius:9999,objectFit:"cover",display:"block",margin:10}}),(0,e.jsx)(L,{strong:!0,style:{fontSize:"18px"},children:o.name})]}),(0,e.jsx)(ne,{style:{flex:1,padding:"24px",backgroundColor:"#f9f9f9",overflowY:"auto",display:"flex",flexDirection:"column-reverse",overflow:"scroll",height:"78vh"},children:T()(E).reverse().map(function(r,t){var s=r.sender_id===String(Z.user.id);return(0,e.jsx)("div",{style:{alignSelf:s?"flex-end":"flex-start",background:s?"#1677ff":"#e4e6eb",color:s?"#fff":"#000",padding:"12px 18px",borderRadius:20,maxWidth:"65%",marginTop:10,boxShadow:"0 2px 5px rgba(0, 0, 0, 0.08)",wordBreak:"break-word"},children:r.type_message==="text"?(0,e.jsx)(L,{style:{fontSize:"15px"},children:r.message}):(0,e.jsx)("img",{src:r.message,style:{width:"100%"}})},t)})}),(0,e.jsxs)("div",{style:{display:"flex",padding:"16px",background:"#fff",borderTop:"1px solid #e8e8e8"},children:[(0,e.jsx)(_.Z,{accept:"image/*",showUploadList:!1,beforeUpload:function(t){return M(t)},children:(0,e.jsx)(f.ZP,{icon:(0,e.jsx)(V.Z,{}),style:{borderRadius:"50%",marginRight:12,width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center"}})}),(0,e.jsx)(H.Z,{value:y,onChange:function(t){return d(t.target.value)},placeholder:"Nh\u1EADp tin nh\u1EAFn...",style:{flex:1,marginRight:12,borderRadius:24,padding:"8px 16px",fontSize:16}}),(0,e.jsx)(f.ZP,{type:"primary",icon:(0,e.jsx)(X.Z,{}),onClick:R,style:{borderRadius:24,padding:"0 20px",height:40}})]})]})},se=te,re=n(23231),oe=n(57355),N=n(23102),p=n(63299),O=n(67535),ue=g.Z.Header,ce=g.Z.Content,D=A.Z.Text,ae=function(){var x=(0,c.useDispatch)(),S=(0,c.useSelector)(function(t){return t.conversation}),h=S.profileSearch,C=S.historyConversation,a=S.userIsFocus,y=(0,c.useSelector)(function(t){return t.auth}),d=y.authData,B=(0,l.useState)(""),o=m()(B,2),j=o[0],Z=o[1],z=function(){x({type:"conversation/searchUserByName",payload:j})},I=(0,l.useState)(window.innerWidth<768),E=m()(I,2),i=E[0],R=E[1];(0,l.useEffect)(function(){var t=function(){return R(window.innerWidth<768)};return window.addEventListener("resize",t),function(){return window.removeEventListener("resize",t)}},[]);var P=!i||i&&!(a!=null&&a.conversation_id),M=!i||i&&(a==null?void 0:a.conversation_id),r=function(s,v,W,u){x({type:"conversation/getInfoUser",payload:{selfId:d.user.id,userId:s,name:W,avatar:v,is_online:u}})};return(0,l.useEffect)(function(){(0,b.Qr)(d)||x({type:"conversation/getListHistoryConversation",payload:d.user.id})},[h,d]),(0,e.jsx)(g.Z,{style:{minHeight:"100vh",maxHeight:"100vh",overflow:"hidden"},children:(0,e.jsxs)(oe.Z,{gutter:16,style:{height:"100%"},children:[(0,e.jsxs)(N.Z,{xs:24,sm:8,md:6,style:{borderRight:"1px solid #f0f0f0",padding:20,background:"#fff",display:P?"flex":"none",flexDirection:"column",height:"100%"},children:[(0,e.jsx)(D,{strong:!0,style:{marginBottom:10,fontSize:18},children:"Danh s\xE1ch cu\u1ED9c tr\xF2 chuy\u1EC7n"}),(0,e.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:16},children:[(0,e.jsx)(H.Z,{placeholder:"T\xECm ki\u1EBFm ng\u01B0\u1EDDi d\xF9ng",value:j,onChange:function(s){return Z(s.target.value)}}),(0,e.jsx)(f.ZP,{type:"default",onClick:z,style:{height:30,width:100},children:"T\xECm ki\u1EBFm"})]}),h.length>0?(0,e.jsx)(p.Z,{itemLayout:"horizontal",dataSource:h,renderItem:function(s){return(0,e.jsx)(p.Z.Item,{style:{borderBottom:"1px solid #f0f0f0"},children:(0,e.jsxs)(f.ZP,{style:{width:"100%",display:"flex",alignItems:"center",padding:"10px",borderRadius:8,transition:"0.3s",background:"#fff",marginBottom:5,border:"1px solid #ddd",height:50},onClick:function(){return r(s.id,s.avatar,s.name,s.is_online)},children:[(0,e.jsx)(O.Z,{src:s.avatar,size:40,style:{marginRight:10}}),(0,e.jsx)(D,{style:{textAlign:"left",fontSize:16},children:s.name})]})})}}):C.length===0?(0,e.jsxs)("div",{style:{display:"flex",flex:1,flexDirection:"column",alignItems:"center",textAlign:"center",fontSize:16,color:"#888"},children:[(0,e.jsx)(re.Z,{style:{fontSize:48,marginBottom:8}}),"H\xE3y k\u1EBFt n\u1ED1i v\u1EDBi m\u1ECDi ng\u01B0\u1EDDi!"]}):(0,e.jsx)(p.Z,{itemLayout:"horizontal",dataSource:C,renderItem:function(s){return(0,e.jsx)(p.Z.Item,{style:{borderBottom:"1px solid #f0f0f0"},children:(0,e.jsxs)(f.ZP,{style:{width:"100%",display:"flex",alignItems:"center",justifyItems:"left",padding:"10px",borderRadius:8,transition:"0.3s",background:"#fff",marginBottom:5,border:"1px solid #ddd",height:50},onClick:function(){console.log(s),r(s.id,s.avatar,s.name,s.is_online)},children:[(0,e.jsx)(O.Z,{src:s.avatar,size:40,style:{marginRight:10}}),(0,e.jsx)(D,{style:{textAlign:"left",fontSize:16},children:s.name})]})})}})]}),(0,e.jsx)(N.Z,{xs:24,sm:16,md:18,style:{height:"100%",display:M?"flex":"none",flexDirection:"column"},children:a.user_id!==""&&(0,e.jsx)(se,{isMobile:i})})]})})},ie=ae}}]);
